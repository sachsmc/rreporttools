{
    "contents" : "<style type=\"text/css\">\nbody {\npadding-left: 100px;\npadding-right: 100px;\n}\n</style>\n\n\nThe `rreporttools` Package and More Resources\n========================================================\n\nIntroduction and Installation\n---------------------------------------\nThe goal of this package is to provide a set of tools to make analysts' lives easier. I've written a set of functions that I found to be helpful in performing common reporting tasks. These tasks include reading data from a database, performing simple analyses on a large number of subsets of the data, writing to/reading from MS Excel, and creating [Shiny Applications](http://www.rstudio.com/shiny). \n\nMy aim is for this package is to get analysts who are not experienced in `R` to use it regularly, thereby gaining experience. If you find these tools useful and they make your reporting life easier, I encourages you to learn more about `R` so that you can improve this package even further. \n\nUsing these basic tools requires some introductory knowledge of how to use `R`. I assume for the moment that you have [R](http:///cran.r-project.org) and [R Studio](http://www.rstudio.com) installed on your computer. If not, go submit a ticket, and tell the IT person that open-source software is nothing to fear. (Aside: calling `R` \"freeware\" is offensive to the hundreds of developers and thousands of users. )\n\nTo get started, I strongly recommend reading [R for Beginners](http://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf). Even if you have used `R` before, you should read it, it's short and you might learn something new. For links to more detailed courses and reference material, see the table at the end of this document. \n\nAll set? Good, to install the `rreporttools` package, run the following commands:\n\n```{r eval = FALSE}\ndepends  <- c(\"devtools\", \"knitr\", \"xlsx\", \"data.table\", \"plyr\", \"RJDBC\", \"reshape2\", \"shiny\")\nwillinstall <- sapply(depends, function(x) !x %in% rownames(installed.packages()))\nif(sum(willinstall) > 0) install.packages(depends[willinstall])\n\nlibrary(devtools)\ninstall_github(\"rreporttools\", \"sachsmc\")\n```\n\nIf you get an error, the most likely cause is a mismatch of the Java and `R` architechtures. Chances are, you only have 32-bit Java installed, therefore you must run 32-bit `R` in order to use Java. To change this, go to Tools > Options and __Change the R version__, then restart Rstudio. If you have further problems with rJava, see this link [help with rJava](https://stackoverflow.com/questions/7019912/using-the-rjava-package-on-win7-64-bit-with-r?rq=1).\n\nLoad the package and check for errors.\n```{r eval = TRUE}\nlibrary(rreporttools)\n```\n\nReading data into `R`\n-----------------------------------------------------\n\nThe first step to doing an analysis in `R` is getting the necessary data loaded. Typically, we need to load data from a database of some kind. `rreporttools` includes several functions to make that possible. These depend heavily on the [RJDBC package](http://cran.r-project.org/web/packages/RJDBC/index.html). \n\nTo connect to an Oracle database using Java, you must find the path to the Oracle Java Database Connection (ojdbc) driver on your computer. On Windows, search for \"ojdbc6.jar\" from the start menu. Then tell the `JDBC` function where it is located. Finally, tell `R` what character to use for quoting. By convention, Oracle uses the single quote `\"'\"`. The following works on my computer for creating the driver object. \n\n```{r eval = TRUE}\ndrv <- JDBC(driverClass = \"oracle.jdbc.OracleDriver\", \n            classPath = \"C:/app/OITDSKADM/product/11.2.0/client_1/jdbc/lib/ojdbc6.jar\", \n            identifier.quote = \"'\")\n```\n\nOnce you have the driver set up, connecting to the database requires a particular server string. The following works for creating a connection object:\n```{r eval = FALSE}\nconn <- dbConnect(drv, \n                  \"jdbc:oracle:thin:@hostname:port:tablename\", \n                  user = \"your_username\", \n                  pass = \"your_password\")\n```\n\nTest out your connection!\n\n```{r eval = FALSE}\ntest <- mydbGetQuery(conn, \"select * from all_tables\", key = \"owner\")\n```\n\nDon't forget to disconnect when you are done!\n\n```{r eval = FALSE}\ndbDisconnect(conn)\n```\n\nIf you have some existing SQL queries in a sas file or in a .sql file, you can use this function to automatically convert them into `R` queries and optionally returning the results as data frames. See the help file for more information. This is experimental, so check your results carefully!\n\n```{r eval = FALSE}\nconvertSASQuery(\"mySasCode.sas\", \"your_username\", \"your_password\", submit = FALSE)\n```\n\nIn `R`, a SQL query is simply a character object. Therefore, the variety of string manipulation tools in `R` are at your disposal to dynamically and programmatically modify SQL queries. Try doing that in SAS! For example, let's say we want to pull the tables that are owned by a specified user. First lets connect to an example database.\n\n```{r eval = FALSE}\nconn <- dbConnect(drv, \n                  \"somewhere\", \n                  user = myUsername, \n                  pass = myPassword)\n```\n\nNow let's create a skeleton query, that we will then modify to specify the owner:\n\n```{r eval = FALSE}\nskelQuery <- \"select owner, table_name from all_tables where owner = '%s'\"\n```\n\nThe `%s` is a placeholder for a string. We will use the `sprintf` function to replace that placeholder with the desired user:\n\n```{r eval = FALSE}\nmodQuery <- sprintf(skelQuery, \"myusername\")\nmydbGetQuery(conn, modQuery, key = \"table_name\")\n```\n\nPretty cool! You can imagine creating a simple function that returns tables owned by the specified user:\n\n```{r eval = FALSE}\ntablesOwnedBy <- function(user){\n  \n  modQuery <- sprintf(\"select owner, table_name from all_tables where owner = '%s'\", user)\n  mydbGetQuery(conn, modQuery)\n  \n}\n```\n\nThis is a simple example, but there are many useful applications of this concept. For instance, loop through a long list of names and dynamically create queries to search the table using the `like` statement. Close matches were automatically returned. It saved me a ton of manual searching and copy-pasting. Think about how you could use this technique in one of your recent reports. \n\nDon't forget to disconnect!\n```{r}\ndbDisconnect(conn)\n```\n\n\nThe Split $\\rightarrow$ Apply $\\rightarrow$ Combine model for Reporting\n--------------------------\n\nThe split/apply/combine approach is nothing new, but it was made useful and easy to do in `R` by [Hadley Wickham](http://vita.had.co.nz/) with the `plyr` package. The following links will get you up to speed:\n\n  - [homepage for plyr](http://plyr.had.co.nz/)\n  - [short presentation](http://www.cerebralmastication.com/wp-content/uploads/2009/10/r-plyr-20091029.pdf)\n\nThis package extends `plyr` by additionally computing sub-totals and totals. The same thing can be acheived with the `data.table` package, but faster and with a different syntax. See the functions `ddplyWithTotals` and `DTplyWithTotals` for usage and examples. A brief example is given below.\n\nFirst examine the `mtcars` dataset, which is a famous data set that has the results of Motor Trends car road tests. It should be loaded automatically when you start `R`. If not, run `data(mtcars)`.\n\n```{r}\nhead(mtcars)\n```\n\nNow suppose you want to compute the average car weight by number of cylinders and number of gears. With `plyr` it's easy.\n\n```{r}\nlibrary(plyr)\nddply(mtcars, ~ cyl + gear, function(df) data.frame(mean_wt = mean(df$wt)))\n```\n\nWe can do the same thing with the `data.table` package, but note that the by variables must be converted to factors first.\n\n```{r results = 'hide'}\nmtcars2 <- data.table(mtcars, key = c(\"cyl\", \"gear\"))\nmtcars2[, cyl := as.factor(cyl)]\nmtcars2[, gear := as.factor(gear)]\n```\n```{r}\nmtcars2[ , list(mean_wt = mean(wt)), by = c(\"cyl\", \"gear\")]\n```\nNow, lets say we want to add the total. \n\n```{r eval = 2}\nddplyWithTotals(mtcars, ~cyl + gear, function(df) data.frame(mean_wt = mean(df$wt)))\nDTplyWithTotals(mtcars2, c(\"cyl\", \"gear\"), list(mean_wt = mean(wt)))\n```\nOptions allow for grand totals. \n\n```{r eval = 1}\nddplyWithTotals(mtcars, ~cyl + gear, function(df) data.frame(mean_wt = mean(df$wt)), grandTotal = TRUE)\nDTplyWithTotals(mtcars2, c(\"cyl\", \"gear\"), list(mean_wt = mean(wt)), grandTotal = TRUE)\n```\n\nThe `nestedOnly` option computes totals only for values nested within the outermost values. This is important as an option when there are three or more by variables.\n\n```{r eval = 1}\nddplyWithTotals(mtcars, ~cyl + gear, function(df) data.frame(mean_wt = mean(df$wt)), nestedOnly = TRUE)\nDTplyWithTotals(mtcars2, c(\"cyl\", \"gear\"), list(mean_wt = mean(wt)), nestedOnly = TRUE)\n```\nThe results here are the same, but for large data sets, you will need to use `DT`. However, `DT` requires the `by` variables to be factors, while `ddply` can deal with numeric variables. \n\nWriting tables into Excel templates\n--------------------------------\n\nIf you do nothing else with `R`, I encourage you to use the automatic output and formatting functions that I've provided. This package includes an example template template, and can output a data frame to it with the appropriate formatting. Here is a quick example using the mtcars dataset.\n\n```{r eval = FALSE}\ncartable <- ddplyWithTotals(mtcars, ~cyl + gear, \n                            function(df) data.frame(mean_wt = mean(df$wt), sd_wt = sd(df$wt)),\n                            grandTotal = TRUE)\n\nmywb <- formatDataFrame(df = cartable, wb = NULL, outputFile = \"cartable.xlsx\", \n                        freezeFrame = FALSE, \n                        styleList = c(\"textStyle\", \"textStyle\", \"numberStyle\", \"numberStyle\"), \n                        save = FALSE)\nmywb2 <- formatTotals(mywb, cartable, \n                      styleLookup = c(\"textStyle\", \"textStyle\", \"numberStyle\", \"numberStyle\"), \n                      sheet = 2, sr = 7)\n\nsaveWorkbook(mywb2, file = \"cartable.xlsx\")\n```\nRun it for yourself and check out the results. Additional format types are available, see the `formatDataFrame` help file for more details.\n\n![cartable screenshot](cartable.png)\n\nWriting Shiny Applications\n-------------------------------------\n\nTo get started writing your own shiny app, we provide a skeleton app with an intialization function `authorShiny`. Give the function a folder name, and it will create the skeleton app, run it, and open the files that you will need to edit to customize your app. Try it out:\n\n```{r eval = FALSE}\nauthorShiny(\"myApp\")\n```\n\nDetails on authoring shiny apps are beyond the scope of this vignette. A good place to get started is with the [shiny tutorial](http://rstudio.github.io/shiny/tutorial/). For help, [email me](mailto:michael.sachs@nih.gov), or go to the [google groups page for shiny](https://groups.google.com/forum/#!forum/shiny-discuss). Interactive graphics can be achieved in various ways, but I have been using [d3.js](http://d3js.org/).\n\nAdditional Resources\n-------------------------------------------\nThis barely scratches the surface of what you can do with `R`, but hopefully it demostrates that `R` is very useful for creating accurate and reproducible reports. Additional reading for learning about `R` is in the table below. When in doubt, read the help files!\n\nTopic | Type | Link\n-----|---|---\n__Introductory `R`__ | | \n | Quick Intro | http://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf\n | Google Dev's `R` Tutorial | http://www.youtube.com/playlist?list=PLOU2XLYxmsIK9qQfztXeybpHvru-TrqAP\n | Impatient `R` | http://www.burns-stat.com/documents/tutorials/impatient-r/\n__General `R` Reference__ | | \n  | Summer Course  | http://faculty.washington.edu/kenrice/rintro/index.shtml\n | Reference | http://cran.r-project.org/doc/manuals/r-release/R-intro.html\n | Web Reference | http://www.cookbook-r.com/\n | List of Resources | http://cran.r-project.org/other-docs.html\n__More Advanced `R`__ |  | \n | How to Make Documents Like This | https://support.rstudio.com/hc/en-us/articles/200552086-Using-R-Markdown\n | The `R` Inferno | http://www.burns-stat.com/pages/Tutor/R_inferno.pdf\n | Hadley Wickham's Advanced `R` Book | http://adv-r.had.co.nz/\n__`plyr`__ |  | \n | Homepage | http://plyr.had.co.nz/\n  | Paper | http://www.jstatsoft.org/v40/i01\n  | Presentation | http://www.cerebralmastication.com/wp-content/uploads/2009/10/r-plyr-20091029.pdf\n  | Presentation | http://streaming.stat.iastate.edu/workshops/r-intro/lectures/6-advancedmanipulation.pdf\n  __`data.table`__ | | \n  | Intro | http://datatable.r-forge.r-project.org/datatable-intro.pdf\n  | Reference | http://datatable.r-forge.r-project.org/datatable-faq.pdf\n  | Presentation | http://datatable.r-forge.r-project.org/CologneR_2013.pdf\n__`xlsx`__ | | \n | Home page | https://code.google.com/p/rexcel/\n | Intro | http://cran.r-project.org/web/packages/xlsx/vignettes/xlsx.pdf\n__`shiny`__ | | \n   | Home page | https://www.rstudio.com/shiny \n   | Tutorial | http://rstudio.github.io/shiny/tutorial/\n   | Layouts | https://github.com/rstudio/shiny/wiki/Shiny-Application-Layout-Guide\n   | Support Group | https://groups.google.com/forum/#!forum/shiny-discuss\n__D3__ |  |\n | Home page | http://d3js.org/\n | List of Tutorials | https://github.com/mbostock/d3/wiki/Tutorials\n | Intro | http://alignedleft.com/tutorials/d3/\n__`R` Opinion__ | | \n | Problems with Spreadsheets | http://www.burns-stat.com/documents/tutorials/spreadsheet-addiction/\n | Why use `R` | http://thetarzan.wordpress.com/2011/07/15/why-use-r-a-grad-students-2-cents/",
    "created" : 1393599651229.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2954820076",
    "id" : "20815CD6",
    "lastKnownWriteTime" : 1393600083,
    "path" : "C:/Users/sachsmc/Downloads/rreporttools/vignettes/introduction.Rmd",
    "project_path" : "vignettes/introduction.Rmd",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}